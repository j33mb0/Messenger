{"ast":null,"code":"import { Validators } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"../data.service\";\nimport * as i3 from \"../signal-r.service\";\nimport * as i4 from \"../chat.service\";\nimport * as i5 from \"@angular/common\";\n\nconst _c0 = function (a0) {\n  return {\n    selectedChat: a0\n  };\n};\n\nfunction ChatlistComponent_li_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"li\")(1, \"div\", 7);\n    i0.ɵɵlistener(\"click\", function ChatlistComponent_li_3_Template_div_click_1_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r6);\n      const chat_r4 = restoredCtx.$implicit;\n      const ctx_r5 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r5.onChatClick(chat_r4));\n    });\n    i0.ɵɵelement(2, \"img\", 8);\n    i0.ɵɵelementStart(3, \"div\", 9)(4, \"h3\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"p\");\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"div\", 10)(9, \"p\");\n    i0.ɵɵtext(10);\n    i0.ɵɵpipe(11, \"date\");\n    i0.ɵɵelementEnd()()()();\n  }\n\n  if (rf & 2) {\n    const chat_r4 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(8, _c0, chat_r4 === ctx_r0.selectedChat));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"src\", chat_r4.otherUserImg, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(chat_r4.otherUserName);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(chat_r4.lastMessage);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(11, 5, chat_r4.lastMessageDate, \"medium\"));\n  }\n}\n\nfunction ChatlistComponent_li_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\")(1, \"p\", 11);\n    i0.ɵɵtext(2, \"No chats available yeat\");\n    i0.ɵɵelementEnd()();\n  }\n}\n\nfunction ChatlistComponent_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 12)(1, \"button\", 13);\n    i0.ɵɵlistener(\"click\", function ChatlistComponent_div_6_Template_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r7 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r7.openAddPanel());\n    });\n    i0.ɵɵtext(2, \"Create new chat\");\n    i0.ɵɵelementEnd()();\n  }\n}\n\nfunction ChatlistComponent_div_7_div_14_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\")(1, \"div\", 25);\n    i0.ɵɵelement(2, \"img\", 26);\n    i0.ɵɵelementStart(3, \"p\", 27);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"button\", 28);\n    i0.ɵɵlistener(\"click\", function ChatlistComponent_div_7_div_14_Template_button_click_5_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r13);\n      const result_r11 = restoredCtx.$implicit;\n      const ctx_r12 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r12.createChat(result_r11.userid));\n    });\n    i0.ɵɵtext(6, \"Create chat\");\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const result_r11 = ctx.$implicit;\n    const ctx_r9 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"src\", result_r11.userimgurl ? result_r11.userimgurl : ctx_r9.userDefaultImg, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(result_r11.username);\n  }\n}\n\nfunction ChatlistComponent_div_7_div_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 29)(1, \"p\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r10 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r10.ChatCreateErrorMsg);\n  }\n}\n\nfunction ChatlistComponent_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r15 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 14)(1, \"div\", 15)(2, \"button\", 16);\n    i0.ɵɵlistener(\"click\", function ChatlistComponent_div_7_Template_button_click_2_listener() {\n      i0.ɵɵrestoreView(_r15);\n      const ctx_r14 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r14.closeAddPanel());\n    });\n    i0.ɵɵtext(3, \"\\u00D7\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"label\", 17);\n    i0.ɵɵtext(5, \"Search user\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"div\", 18)(7, \"form\", 19);\n    i0.ɵɵelement(8, \"input\", 20);\n    i0.ɵɵelementStart(9, \"button\", 21);\n    i0.ɵɵlistener(\"click\", function ChatlistComponent_div_7_Template_button_click_9_listener() {\n      i0.ɵɵrestoreView(_r15);\n      const ctx_r16 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r16.searchUsers());\n    });\n    i0.ɵɵtext(10, \"search\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(11, \"label\", 22);\n    i0.ɵɵtext(12, \"Results:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"div\", 23);\n    i0.ɵɵtemplate(14, ChatlistComponent_div_7_div_14_Template, 7, 2, \"div\", 2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(15, ChatlistComponent_div_7_div_15_Template, 3, 1, \"div\", 24);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"formGroup\", ctx_r3.searchForm);\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.searchResults);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.isChatCreateErrorMsgVisible);\n  }\n}\n\nexport let ChatlistComponent = /*#__PURE__*/(() => {\n  class ChatlistComponent {\n    constructor(fb, dataService, signalrService, chatService) {\n      this.fb = fb;\n      this.dataService = dataService;\n      this.signalrService = signalrService;\n      this.chatService = chatService;\n      this.chats = [];\n      this.selectedChat = null;\n      this.searchResults = [];\n      this.chatblockheight = 85;\n      this.addpanelheight = 6;\n      this.isAddPanelOpen = false;\n      this.isChatCreateErrorMsgVisible = false;\n      this.ChatCreateErrorMsg = '';\n      this.userDefaultImg = 'https://cdn-icons-png.flaticon.com/512/3607/3607444.png';\n      this.searchForm = this.fb.group({\n        username: ['', Validators.required]\n      });\n    }\n\n    ngOnInit() {\n      this.loadChats();\n      this.signalrService.messageUpdate$.subscribe(message => {\n        this.loadChats();\n      });\n      this.signalrService.chatUpdate$.subscribe(message => {\n        this.loadChats();\n      });\n    }\n\n    loadChats() {\n      this.dataService.getChats().subscribe(result => {\n        this.chats = result.map(chat => ({\n          chatId: chat.chatId,\n          otherUserImg: chat.otherUserImg,\n          otherUserName: chat.otherUserName,\n          lastMessage: chat.lastMessage,\n          lastMessageDate: chat.lastMessageDate\n        }));\n      }, error => {\n        console.log('dataservice.getchats error');\n      });\n    }\n\n    openAddPanel() {\n      this.isAddPanelOpen = true;\n      this.chatblockheight = 50;\n      this.addpanelheight = 41;\n    }\n\n    closeAddPanel() {\n      this.isAddPanelOpen = false;\n      this.chatblockheight = 85;\n      this.addpanelheight = 6;\n    }\n\n    searchUsers() {\n      var _a;\n\n      const username = (_a = this.searchForm.get('username')) === null || _a === void 0 ? void 0 : _a.value;\n\n      if (username) {\n        this.dataService.searchUsersByNickname(username).subscribe(results => {\n          this.searchResults = results;\n        }, error => {});\n      }\n    }\n\n    createChat(userid) {\n      this.dataService.createChat(userid).subscribe(result => {\n        this.loadChats();\n        console.log('createChatincomponent');\n      }, error => {\n        console.log(error.error);\n        this.isChatCreateErrorMsgVisible = true;\n        this.ChatCreateErrorMsg = error.error;\n      });\n    }\n\n    onChatClick(chat) {\n      this.selectedChat = chat;\n      this.chatService.setSelectedChat(chat);\n    }\n\n  }\n\n  ChatlistComponent.ɵfac = function ChatlistComponent_Factory(t) {\n    return new (t || ChatlistComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.DataService), i0.ɵɵdirectiveInject(i3.SignalRService), i0.ɵɵdirectiveInject(i4.ChatService));\n  };\n\n  ChatlistComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ChatlistComponent,\n    selectors: [[\"app-chatlist\"]],\n    decls: 8,\n    vars: 8,\n    consts: [[1, \"maindiv\"], [1, \"chat-block\"], [4, \"ngFor\", \"ngForOf\"], [4, \"ngIf\"], [1, \"addchat-panel\"], [\"class\", \"closed-div\", 4, \"ngIf\"], [\"class\", \"opened-div\", 4, \"ngIf\"], [1, \"chat-container\", 3, \"ngClass\", \"click\"], [3, \"src\"], [1, \"chat-details\"], [1, \"time-message\"], [1, \"nomsgp\"], [1, \"closed-div\"], [1, \"open-button\", 3, \"click\"], [1, \"opened-div\"], [1, \"close-button-container\"], [1, \"close-button\", 3, \"click\"], [1, \"search-label\"], [1, \"searchform-div\"], [3, \"formGroup\"], [\"type\", \"text\", \"id\", \"username\", \"formControlName\", \"username\", \"placeholder\", \"Input username here...\", 1, \"search-input\"], [1, \"formsearch-button\", 3, \"click\"], [1, \"results-label\"], [1, \"searchresults-div\"], [\"class\", \"errorMsgDiv\", 4, \"ngIf\"], [1, \"result-container\"], [1, \"result-userimg\", 3, \"src\"], [1, \"result-p\"], [1, \"createchat-button\", 3, \"click\"], [1, \"errorMsgDiv\"]],\n    template: function ChatlistComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"ul\");\n        i0.ɵɵtemplate(3, ChatlistComponent_li_3_Template, 12, 10, \"li\", 2);\n        i0.ɵɵtemplate(4, ChatlistComponent_li_4_Template, 3, 0, \"li\", 3);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(5, \"div\", 4);\n        i0.ɵɵtemplate(6, ChatlistComponent_div_6_Template, 3, 0, \"div\", 5);\n        i0.ɵɵtemplate(7, ChatlistComponent_div_7_Template, 16, 3, \"div\", 6);\n        i0.ɵɵelementEnd()();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(1);\n        i0.ɵɵstyleProp(\"height\", ctx.chatblockheight, \"vh\");\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngForOf\", ctx.chats);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.chats || ctx.chats.length === 0);\n        i0.ɵɵadvance(1);\n        i0.ɵɵstyleProp(\"height\", ctx.addpanelheight, \"vh\");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.isAddPanelOpen);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.isAddPanelOpen);\n      }\n    },\n    dependencies: [i5.NgClass, i5.NgForOf, i5.NgIf, i1.ɵNgNoValidate, i1.DefaultValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.FormGroupDirective, i1.FormControlName, i5.DatePipe],\n    styles: [\".maindiv[_ngcontent-%COMP%]{margin-left:10px;margin-top:10px}ul[_ngcontent-%COMP%]{list-style-type:none;padding:0;width:100%;height:100%;margin:0}.nomsgp[_ngcontent-%COMP%]{margin-top:80px;margin-left:70px}.chat-block[_ngcontent-%COMP%]{background-color:#e6e6fa;border:1px solid #888;border-radius:2px;width:18vw;display:flex;padding:0;margin:0;flex-direction:column;justify-content:space-between;overflow:auto;transition:width .3s}.chat-container[_ngcontent-%COMP%]{display:flex;align-items:center;padding:4px 0 4px 4px;border:1px solid #ccc;overflow:hidden}.selectedChat[_ngcontent-%COMP%]{display:flex;align-items:center;padding:4px 0 4px 4px;border:2px solid #ccc;overflow:hidden;background-color:#7fffd4}.chat-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:69px;height:69px;border-radius:50%;margin-right:10px}.chat-details[_ngcontent-%COMP%]{width:100%;align-items:flex-end;flex-grow:1}.chat-details[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:30px;font-size:18px;margin-left:10px}.chat-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{width:170px;height:29px;margin-top:-25px;color:#888;font-size:14px}.time-message[_ngcontent-%COMP%]{font-size:13px}.time-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#888;padding:18px 0 0}.chat-block[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.chat-block[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1}.chat-block[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#888}.chat-block[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#555}.addchat-panel[_ngcontent-%COMP%]{width:18vw;margin-top:5px;background-color:#e6e6fa;border:1px solid #888;border-radius:2px;transition:width .3s}.open-button[_ngcontent-%COMP%]{width:18vw;height:6vh;background-color:#5f9ea0}.close-button-container[_ngcontent-%COMP%]{align-items:center;display:flex;justify-content:space-between}.close-button[_ngcontent-%COMP%]{margin-left:auto;margin-top:2px;margin-right:2px}.searchform-div[_ngcontent-%COMP%]{padding-top:10px}.search-label[_ngcontent-%COMP%]{margin-left:110px}.results-label[_ngcontent-%COMP%]{margin-left:120px}.search-input[_ngcontent-%COMP%]{width:68%;height:15px;padding:.375rem .75rem;font-family:inherit;font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;background-clip:padding-box;border:1px solid #bdbdbd;border-radius:.25rem;transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out;margin-left:5px;margin-right:5px;margin-bottom:15px}.formsearch-button[_ngcontent-%COMP%]{width:20%;height:25px}.searchresults-div[_ngcontent-%COMP%]{width:90%;height:215px;background-color:#faebd7;border:1px solid #888;border-radius:2px;display:block;padding:0;margin-left:15px;flex-direction:column;justify-content:space-between;overflow:auto;transition:width .3s}.result-container[_ngcontent-%COMP%]{display:flex;align-items:center;padding:4px 0 4px 4px;border:1px solid #ccc;height:40px}.result-userimg[_ngcontent-%COMP%]{height:30px;width:30px;margin-left:5px}.result-p[_ngcontent-%COMP%]{margin-left:15px}.createchat-button[_ngcontent-%COMP%]{margin-left:auto;margin-right:15px}.errorMsgDiv[_ngcontent-%COMP%]{background-color:#ec6262;height:30px;width:90%;color:#140f0f;border-radius:3px;display:flex;align-items:center;justify-content:center;margin-top:10px;margin-left:15px}\"]\n  });\n  return ChatlistComponent;\n})();\nexport class Chat {\n  constructor() {\n    this.chatId = '';\n    this.otherUserName = '';\n    this.lastMessage = '';\n    this.otherUserImg = '';\n    this.lastMessageDate = '';\n  }\n\n}","map":null,"metadata":{},"sourceType":"module"}