{"ast":null,"code":"import { ElementRef } from '@angular/core';\nimport { Subscription } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../chat.service\";\nimport * as i2 from \"../data.service\";\nimport * as i3 from \"../auth.service\";\nimport * as i4 from \"../signal-r.service\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"@angular/forms\";\nconst _c0 = [\"messagecontainer\"];\n\nfunction ChatviewComponent_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 10);\n    i0.ɵɵelement(1, \"img\", 11);\n    i0.ɵɵelementStart(2, \"p\", 12);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"src\", ctx_r0.selectedChat.otherUserImg, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r0.selectedChat.otherUserName);\n  }\n}\n\nfunction ChatviewComponent_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 10);\n    i0.ɵɵelement(1, \"img\", 11);\n    i0.ɵɵelementStart(2, \"p\", 12);\n    i0.ɵɵtext(3, \"Username\");\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"src\", ctx_r1.userDefaultImg, i0.ɵɵsanitizeUrl);\n  }\n}\n\nconst _c1 = function (a0, a1) {\n  return {\n    \"from-other\": a0,\n    \"from-current\": a1\n  };\n};\n\nconst _c2 = function (a0, a1) {\n  return {\n    \"from-other-content\": a0,\n    \"from-current-content\": a1\n  };\n};\n\nconst _c3 = function (a0, a1) {\n  return {\n    \"from-other-date\": a0,\n    \"from-current-date\": a1\n  };\n};\n\nfunction ChatviewComponent_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 13)(1, \"p\", 13);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"p\", 13);\n    i0.ɵɵtext(4);\n    i0.ɵɵpipe(5, \"date\");\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const message_r4 = ctx.$implicit;\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(8, _c1, !ctx_r3.isMessageFromCurrentUser(message_r4), ctx_r3.isMessageFromCurrentUser(message_r4)));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(11, _c2, !ctx_r3.isMessageFromCurrentUser(message_r4), ctx_r3.isMessageFromCurrentUser(message_r4)));\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(message_r4.content);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(14, _c3, !ctx_r3.isMessageFromCurrentUser(message_r4), ctx_r3.isMessageFromCurrentUser(message_r4)));\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(5, 5, message_r4.date, \"medium\"));\n  }\n}\n\nexport let ChatviewComponent = /*#__PURE__*/(() => {\n  class ChatviewComponent {\n    constructor(chatService, dataService, authService, signalrService) {\n      this.chatService = chatService;\n      this.dataService = dataService;\n      this.authService = authService;\n      this.signalrService = signalrService;\n      this.selectedChat = null;\n      this.messages = [];\n      this.sendMessageText = '';\n      this.userDefaultImg = 'https://cdn-icons-png.flaticon.com/512/3607/3607444.png';\n      this.chatSubscription = this.chatService.getSelectedChat().subscribe(chat => {\n        this.selectedChat = chat;\n        this.getMessages();\n      });\n    }\n\n    ngOnInit() {\n      this.getMessages();\n      this.signalrService.messageUpdate$.subscribe(chatId => {\n        var _a;\n\n        if (((_a = this.selectedChat) === null || _a === void 0 ? void 0 : _a.chatId) === chatId) {\n          this.getMessages();\n        }\n      });\n    }\n\n    ngAfterViewChecked() {\n      this.scrollToBottom();\n    }\n\n    ngOnDestroy() {\n      this.chatSubscription.unsubscribe();\n    }\n\n    getMessages() {\n      if (this.selectedChat) {\n        this.dataService.getMessages(this.selectedChat.chatId).subscribe(result => {\n          this.messages = result;\n        }, error => {\n          console.error(error);\n        });\n      }\n    }\n\n    sendMessage() {\n      var _a;\n\n      if (this.selectedChat) {\n        if (this.sendMessageText.length > 0) {\n          this.dataService.sendMessage((_a = this.selectedChat) === null || _a === void 0 ? void 0 : _a.chatId, this.sendMessageText).subscribe(result => {\n            this.getMessages();\n          });\n          this.sendMessageText = '';\n        }\n      }\n    }\n\n    isMessageFromCurrentUser(message) {\n      const currentUserId = Number(this.authService.getUserId());\n      return message.userId === currentUserId;\n    }\n\n    scrollToBottom() {\n      if (this.messageContainer) {\n        this.messageContainer.nativeElement.scrollTop = this.messageContainer.nativeElement.scrollHeight;\n        console.log('Scrolling to bottom...');\n      }\n    }\n\n  }\n\n  ChatviewComponent.ɵfac = function ChatviewComponent_Factory(t) {\n    return new (t || ChatviewComponent)(i0.ɵɵdirectiveInject(i1.ChatService), i0.ɵɵdirectiveInject(i2.DataService), i0.ɵɵdirectiveInject(i3.AuthService), i0.ɵɵdirectiveInject(i4.SignalRService));\n  };\n\n  ChatviewComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ChatviewComponent,\n    selectors: [[\"app-chatview\"]],\n    viewQuery: function ChatviewComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 7);\n      }\n\n      if (rf & 2) {\n        let _t;\n\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.messageContainer = _t.first);\n      }\n    },\n    decls: 11,\n    vars: 4,\n    consts: [[1, \"maindiv\"], [1, \"chatview-container\"], [\"class\", \"head\", 4, \"ngIf\"], [1, \"message-container\"], [\"messagecontainer\", \"\"], [3, \"ngClass\", 4, \"ngFor\", \"ngForOf\"], [1, \"message-writter\"], [\"type\", \"text\", \"placeholder\", \"Input message...\", 1, \"inputmessage\", 3, \"ngModel\", \"ngModelChange\"], [1, \"send-btn\", 3, \"click\"], [\"src\", \"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRAJ7Get2YkUhisLi7eQ8HqlShRDI4T9A4QSxjvmA5bkg&s\", 1, \"send-button-img\"], [1, \"head\"], [\"alt\", \"non\", 1, \"imguser\", 3, \"src\"], [1, \"username\"], [3, \"ngClass\"]],\n    template: function ChatviewComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1);\n        i0.ɵɵtemplate(2, ChatviewComponent_div_2_Template, 4, 2, \"div\", 2);\n        i0.ɵɵtemplate(3, ChatviewComponent_div_3_Template, 4, 1, \"div\", 2);\n        i0.ɵɵelementStart(4, \"div\", 3, 4);\n        i0.ɵɵtemplate(6, ChatviewComponent_div_6_Template, 6, 17, \"div\", 5);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(7, \"div\", 6)(8, \"input\", 7);\n        i0.ɵɵlistener(\"ngModelChange\", function ChatviewComponent_Template_input_ngModelChange_8_listener($event) {\n          return ctx.sendMessageText = $event;\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(9, \"button\", 8);\n        i0.ɵɵlistener(\"click\", function ChatviewComponent_Template_button_click_9_listener() {\n          return ctx.sendMessage();\n        });\n        i0.ɵɵelement(10, \"img\", 9);\n        i0.ɵɵelementEnd()()()();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.selectedChat);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.selectedChat);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngForOf\", ctx.messages);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngModel\", ctx.sendMessageText);\n      }\n    },\n    dependencies: [i5.NgClass, i5.NgForOf, i5.NgIf, i6.DefaultValueAccessor, i6.NgControlStatus, i6.NgModel, i5.DatePipe],\n    styles: [\".chatview-container[_ngcontent-%COMP%]{background-color:#e6e6fa;height:92vh;width:80vw;border:1px solid #888;border-radius:2px;margin:7px 0 0 7px;padding:0;display:flex;flex-direction:column;justify-content:space-between}.head[_ngcontent-%COMP%]{background-color:#ceceeb;display:flex;border-bottom:1px solid #888}.imguser[_ngcontent-%COMP%]{height:83px;width:83px;padding:7px 0 7px 37px}.username[_ngcontent-%COMP%]{font-size:22px;padding:15px 0 0 25px}.message-container[_ngcontent-%COMP%]{width:100%;height:100%;flex-direction:column;justify-content:flex-end;align-items:flex-start;overflow:auto}.message-container[_ngcontent-%COMP%]::-webkit-scrollbar{width:0}.message-writter[_ngcontent-%COMP%]{display:flex;border-top:1px solid #888}.send-button-img[_ngcontent-%COMP%]{width:50px;height:50px}.inputmessage[_ngcontent-%COMP%]{width:100%;font-size:17px}.from-other[_ngcontent-%COMP%]{border:1px solid #ccc;display:flex;flex-direction:column;vertical-align:middle;width:100%;background-color:#bfd6d3}.from-current[_ngcontent-%COMP%]{border:1px solid #ccc;display:flex;flex-direction:column;vertical-align:middle;width:100%}.from-other-date[_ngcontent-%COMP%], .from-current-date[_ngcontent-%COMP%]{align-self:flex-end;margin-top:0;margin-right:20px}.from-other-content[_ngcontent-%COMP%]{margin-left:20px;font-size:20px}.from-current-content[_ngcontent-%COMP%]{margin-left:auto;margin-right:250px;font-size:20px}\"]\n  });\n  return ChatviewComponent;\n})();\nexport class Message {\n  constructor() {\n    this.messageId = '';\n    this.userId = 0;\n    this.userName = '';\n    this.content = '';\n    this.date = '';\n  }\n\n}","map":null,"metadata":{},"sourceType":"module"}